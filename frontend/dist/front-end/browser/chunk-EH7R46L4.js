import{a as ae}from"./chunk-OPID4UBU.js";import{a as te,b as re}from"./chunk-BMEYXFRB.js";import{a as ie,b as ne}from"./chunk-FU2RVMGM.js";import{A as R,T as U,U as j,Xa as ee,Ya as oe,_a as le,da as H,ea as Z,fa as J,ga as K,ha as Q,i as V,ia as X,j as A,ja as Y,k as d,ka as $,l as x,m as P,q as L,s as z,t as W,x as B,y as G}from"./chunk-JS2QCX3E.js";import{Cb as c,Hb as q,Ic as D,Ma as a,Na as _,Nb as n,Ob as I,Rb as C,Sb as g,Tb as v,Xa as E,a as f,cb as y,nb as s,qa as k,tb as t,ub as l,vb as u,xa as h}from"./chunk-VXWA6INE.js";function de(i,o){i&1&&(t(0,"clr-control-error"),n(1," First name is required. "),l())}function ce(i,o){i&1&&(t(0,"clr-control-error"),n(1," Last name is required. "),l())}function ue(i,o){i&1&&(t(0,"clr-control-error"),n(1," Email is required. "),l())}function ye(i,o){i&1&&(t(0,"clr-control-error"),n(1," Please enter a valid email address. "),l())}function fe(i,o){i&1&&(t(0,"clr-control-error"),n(1," Username is required. "),l())}function he(i,o){i&1&&(t(0,"clr-control-error"),n(1," Username cannot exceed 50 characters. "),l())}function _e(i,o){i&1&&(t(0,"clr-control-error"),n(1," Password is required. "),l())}function Ee(i,o){i&1&&(t(0,"clr-control-error"),n(1," Password must be at least 8 characters long, containing at least one uppercase letter, one lowercase letter, one digit, and one special character. "),l())}function Ce(i,o){i&1&&(t(0,"clr-control-error"),n(1," Role is required. "),l())}var w=class i{constructor(o){this.fb=o}clrModalOpen=!1;employee;isNew=!0;save=new h;close=new h;delete=new h;clrModalOpenChange=new h;employeeForm;showConfirmation=!1;passwordValidators=[d.required,d.minLength(8),d.pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^a-zA-Z0-9]).{8,}$/)];ngOnInit(){this.initializeForm()}ngOnChanges(o){o.employee&&this.employee&&(console.log("\u{1F504} Updating Employee Form with:",this.employee),console.log("isNew value:",this.isNew),this.isNew&&(this.employeeForm.reset(),this.employeeForm.get("password")?.setValidators(this.passwordValidators),this.employeeForm.get("password")?.updateValueAndValidity()),this.updateForm())}initializeForm(){this.employeeForm=this.fb.group({firstName:["",[d.required,d.maxLength(50)]],lastName:["",[d.required,d.maxLength(50)]],email:["",[d.required,d.email]],username:["",[d.required,d.maxLength(50)]],password:["",this.isNew?this.passwordValidators:[]],role:["",d.required],admin:[this.employee?.admin??!1]}),this.employee&&this.employeeForm.patchValue({firstName:this.employee.firstName,lastName:this.employee.lastName,email:this.employee.email,username:this.employee.username||"",password:"",role:this.employee.role,admin:this.employee.admin}),this.isNew&&(this.employeeForm.get("password")?.markAsTouched(),this.employeeForm.get("password")?.updateValueAndValidity()),this.employeeForm.get("password")?.valueChanges.subscribe(o=>{this.updatePasswordValidators(o)})}updateForm(){this.employeeForm&&this.employeeForm.patchValue({firstName:this.employee.firstName,lastName:this.employee.lastName,email:this.employee.email,username:this.employee.username||"",password:"",role:this.employee.role,admin:this.employee.admin??!1})}updatePasswordValidators(o){let r=this.employeeForm.get("password");this.isNew||(o?r?.setValidators(this.passwordValidators):r?.clearValidators(),r?.updateValueAndValidity({emitEvent:!1}))}onSubmit(){if(this.employeeForm.valid){let o=f(f({},this.employee),this.employeeForm.value);if(this.isNew&&!this.employeeForm.get("password")?.value){console.error("Password is required for new employees.");return}!this.isNew&&!this.employeeForm.get("password")?.value&&delete o.password,this.save.emit(o),this.closeModal()}else console.error("Form is invalid. Please fix errors and try again.")}closeModal(){this.clrModalOpen=!1,this.clrModalOpenChange.emit(!1),this.close.emit()}static \u0275fac=function(r){return new(r||i)(_(G))};static \u0275cmp=E({type:i,selectors:[["app-employee-modal"]],inputs:{clrModalOpen:"clrModalOpen",employee:"employee",isNew:"isNew"},outputs:{save:"save",close:"close",delete:"delete",clrModalOpenChange:"clrModalOpenChange"},features:[k],decls:50,vars:15,consts:[[3,"clrModalOpenChange","clrModalOpen"],[1,"modal-title"],[1,"modal-body"],["clrForm","","clrLayout","horizontal","clrLabelSize","3",3,"ngSubmit","formGroup"],["for","firstName",1,"clr-required-mark"],["clrInput","","id","firstName","type","text","formControlName","firstName","required","","size","40"],[4,"ngIf"],["for","lastName",1,"clr-required-mark"],["clrInput","","id","lastName","type","text","formControlName","lastName"],["for","email",1,"clr-required-mark"],["clrInput","","id","email","type","email","formControlName","email"],["for","username",1,"clr-required-mark"],["clrInput","","id","username","type","text","formControlName","username"],["for","password"],["clrInput","","id","password","type","password","formControlName","password",3,"placeholder"],["for","role",1,"clr-required-mark"],["clrInput","","id","role","type","text","formControlName","role"],["for","admin"],["type","checkbox","clrToggle","","formControlName","admin","id","admin"],[1,"modal-footer"],["type","button",1,"btn","btn-outline",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(r,e){if(r&1&&(t(0,"clr-modal",0),v("clrModalOpenChange",function(m){return g(e.clrModalOpen,m)||(e.clrModalOpen=m),m}),c("clrModalOpenChange",function(){return e.closeModal()}),t(1,"h3",1),n(2),l(),t(3,"div",2)(4,"form",3),c("ngSubmit",function(){return e.onSubmit()}),t(5,"clr-input-container")(6,"label",4),n(7,"First Name"),l(),u(8,"input",5),y(9,de,2,0,"clr-control-error",6),l(),t(10,"clr-input-container")(11,"label",7),n(12,"Last Name"),l(),u(13,"input",8),y(14,ce,2,0,"clr-control-error",6),l(),t(15,"clr-input-container")(16,"label",9),n(17,"Email"),l(),u(18,"input",10),y(19,ue,2,0,"clr-control-error",6)(20,ye,2,0,"clr-control-error",6),l(),t(21,"clr-input-container")(22,"label",11),n(23,"Username"),l(),u(24,"input",12),y(25,fe,2,0,"clr-control-error",6)(26,he,2,0,"clr-control-error",6),l(),t(27,"clr-input-container")(28,"label",13),n(29),l(),u(30,"input",14),y(31,_e,2,0,"clr-control-error",6)(32,Ee,2,0,"clr-control-error",6),l(),t(33,"clr-input-container")(34,"label",15),n(35,"Role"),l(),u(36,"input",16),y(37,Ce,2,0,"clr-control-error",6),l(),t(38,"clr-toggle-container")(39,"label",17),n(40,"Administrator"),l(),t(41,"clr-toggle-wrapper"),u(42,"input",18),l(),t(43,"clr-control-helper"),n(44,"Enable to grant administrator permissions"),l()(),t(45,"div",19)(46,"button",20),c("click",function(){return e.closeModal()}),n(47,"Cancel"),l(),t(48,"button",21),n(49,"Save"),l()()()()()),r&2){let p,m,M,b,N,S,F,O,T;C("clrModalOpen",e.clrModalOpen),a(2),I(e.isNew?"Create Employee":"Edit Employee"),a(2),s("formGroup",e.employeeForm),a(5),s("ngIf",(p=e.employeeForm.get("firstName"))==null||p.errors==null?null:p.errors.required),a(5),s("ngIf",(m=e.employeeForm.get("lastName"))==null||m.errors==null?null:m.errors.required),a(5),s("ngIf",(M=e.employeeForm.get("email"))==null||M.errors==null?null:M.errors.required),a(),s("ngIf",(b=e.employeeForm.get("email"))==null||b.errors==null?null:b.errors.email),a(5),s("ngIf",(N=e.employeeForm.get("username"))==null||N.errors==null?null:N.errors.required),a(),s("ngIf",(S=e.employeeForm.get("username"))==null||S.errors==null?null:S.errors.maxlength),a(3),I(e.isNew?"Password":"New Password"),a(),q("placeholder",e.isNew?"Enter password":"Leave blank to keep current password"),a(),s("ngIf",(F=e.employeeForm.get("password"))==null||F.errors==null?null:F.errors.required),a(),s("ngIf",(O=e.employeeForm.get("password"))==null||O.errors==null?null:O.errors.pattern),a(5),s("ngIf",(T=e.employeeForm.get("role"))==null||T.errors==null?null:T.errors.required),a(11),s("disabled",!e.employeeForm.valid)}},dependencies:[R,L,A,V,x,P,B,z,W,D,le,ee,oe,H,U,j,Z,J,Q,X,K,$,Y],styles:["input[clrInput][_ngcontent-%COMP%]{width:30ch;max-width:100%}"]})};var me=class i{constructor(o,r){this.employeeService=o;this.metricsService=r}title="Employees";employees=[];metrics=[];selectedEmployee=null;clrModalOpen=!1;isNew=!0;showDeleteConfirmation=!1;employeeToDelete=null;columns=[{key:"name",label:"Name"},{key:"email",label:"Email"},{key:"role",label:"Role"},{key:"taskCount",label:"Number of Tasks"}];ngOnInit(){this.fetchEmployees()}fetchEmployees(){this.employeeService.getEmployees().subscribe({next:o=>{this.employees=o,this.calculateMetrics(),console.log(o)},error:o=>{console.error("Error fetching employees:",o)}})}calculateMetrics(){this.metrics=this.metricsService.calculateEmployeeMetrics(this.employees)}openModal(o){console.log("openModal called with:",o),o?(this.isNew=!1,this.selectedEmployee=f({},o)):(this.isNew=!0,this.selectedEmployee={id:null,firstName:"",lastName:"",email:"",username:"",role:"",admin:!1,createdAt:"",updatedAt:"",taskCount:0,password:""}),this.clrModalOpen=!0,console.log("clrModalOpen set to:",this.clrModalOpen)}closeModal(){this.clrModalOpen=!1,this.selectedEmployee=null}saveEmployee(o){console.log("Saving employee:",o),this.isNew?this.employeeService.saveEmployee(o).subscribe({next:r=>{this.employees=[...this.employees,r],this.calculateMetrics(),this.closeModal()},error:r=>{console.error("Error saving employee:",r)}}):this.employeeService.updateEmployee(o.id,o).subscribe({next:r=>{this.employees=this.employees.map(e=>e.id===r.id?r:e),this.calculateMetrics(),this.closeModal()},error:r=>{console.error("Error updating employee:",r)}})}confirmDeleteEmployee(o){this.employeeToDelete=o,this.showDeleteConfirmation=!0}deleteEmployee(){if(!this.employeeToDelete)return;let o=this.employeeToDelete.id;o&&(this.employeeService.deleteEmployee(o).subscribe({next:()=>{this.employees=this.employees.filter(r=>r.id!==o),this.calculateMetrics(),this.closeModal()},error:r=>console.error("Error deleting employee:",r)}),this.employeeToDelete=null,this.showDeleteConfirmation=!1)}static \u0275fac=function(r){return new(r||i)(_(re),_(te))};static \u0275cmp=E({type:i,selectors:[["app-employees"]],decls:4,vars:10,consts:[[3,"newAction","metrics","title"],[3,"editClick","deleteClick","columns","data","emptyMessage"],[3,"clrModalOpenChange","save","close","clrModalOpen","employee","isNew"],["title","Employee Deletion",3,"confirmed","canceled","show","message"]],template:function(r,e){r&1&&(t(0,"app-sub-header",0),c("newAction",function(){return e.openModal()}),l(),t(1,"app-table",1),c("editClick",function(m){return e.openModal(m)})("deleteClick",function(m){return e.confirmDeleteEmployee(m)}),l(),t(2,"app-employee-modal",2),v("clrModalOpenChange",function(m){return g(e.clrModalOpen,m)||(e.clrModalOpen=m),m}),c("save",function(m){return e.saveEmployee(m)})("close",function(){return e.closeModal()}),l(),t(3,"app-confirm-modal",3),c("confirmed",function(){return e.deleteEmployee()})("canceled",function(){return e.showDeleteConfirmation=!1}),l()),r&2&&(s("metrics",e.metrics)("title",e.title),a(),s("columns",e.columns)("data",e.employees)("emptyMessage","There are no employees"),a(),C("clrModalOpen",e.clrModalOpen),s("employee",e.selectedEmployee)("isNew",e.isNew),a(),s("show",e.showDeleteConfirmation)("message","Are you sure you want to delete "+(e.employeeToDelete==null?null:e.employeeToDelete.firstName)+" "+(e.employeeToDelete==null?null:e.employeeToDelete.lastName)+"?"))},dependencies:[ie,w,ne,ae],encapsulation:2})};export{me as EmployeesComponent};
